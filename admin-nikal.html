<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<title>Admin Panel тАУ рдирд┐рдХрд╛рд▓ рднрд░рдгреЗ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --primary:#1e40af;
  --bg:#f1f5f9;
  --card:#ffffff;
}
body{
  margin:0;
  padding:16px;
  background:var(--bg);
  font-family:"Noto Sans Devanagari","Mukta",system-ui,sans-serif;
}
.container{max-width:720px;margin:auto;}
.card{
  background:var(--card);
  padding:24px;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,0.12);
}
h1,h2{text-align:center;color:var(--primary);}
label{font-weight:700;margin-top:14px;display:block;}
select,input{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:10px;
  border:1.8px solid #cbd5e1;
  font-size:15px;
}
button{
  width:100%;
  margin-top:20px;
  padding:14px;
  border:none;
  border-radius:12px;
  background:var(--primary);
  color:#fff;
  font-size:16px;
  font-weight:800;
  cursor:pointer;
}
.logout{background:#7c2d12;}
.success{
  margin-top:12px;
  color:#065f46;
  font-weight:800;
  display:none;
  text-align:center;
}

/* table */
table{width:100%;border-collapse:collapse;margin-top:18px;}
th,td{border:1px solid #cbd5e1;padding:8px;text-align:center;}
th{background:#e5e7eb;}
.action-btn{padding:6px 10px;margin:2px;font-size:14px;border-radius:8px;}
.edit{background:#0ea5e9;color:#fff;}
.delete{background:#dc2626;color:#fff;}
</style>
</head>

<body>

<div class="container">
<div class="card">

<h1>ЁЯПЖ рдирд┐рдХрд╛рд▓ рднрд░рдгреЗ (Admin)</h1>

<label>рдХрд╛рд░реНрдпрдХреНрд░рдо рдкреНрд░рдХрд╛рд░</label>
<select id="main">
  <option value="">тАФ рдирд┐рд╡рдбрд╛ тАФ</option>
  <option value="рдХреНрд░реАрдбрд╛">рдХреНрд░реАрдбрд╛</option>
  <option value="рд╕рд╛рдВрд╕реНрдХреГрддрд┐рдХ">рд╕рд╛рдВрд╕реНрдХреГрддрд┐рдХ</option>
</select>

<label>рд╕рд╣рднрд╛рдЧ рдкреНрд░рдХрд╛рд░</label>
<select id="type">
  <option value="">тАФ рдирд┐рд╡рдбрд╛ тАФ</option>
  <option value="рд╡реИрдпрдХреНрддрд┐рдХ">рд╡реИрдпрдХреНрддрд┐рдХ</option>
  <option value="рджреБрд╣реЗрд░реА">рджреБрд╣реЗрд░реА</option>
  <option value="рд╕рд╛рдВрдШрд┐рдХ">рд╕рд╛рдВрдШрд┐рдХ</option>
</select>

<label>рдЦреЗрд│ / рдХрд╛рд░реНрдпрдХреНрд░рдо</label>
<select id="program">
  <option value="">тАФ рдирд┐рд╡рдбрд╛ тАФ</option>
</select>

<label>рдХреНрд░рдорд╛рдВрдХ</label>
<input id="position" placeholder="рдЙрджрд╛. рдкреНрд░рдердо / рджреНрд╡рд┐рддреАрдп / рддреГрддреАрдп">

<label>рд╡рд┐рдЬреЗрддрд╛ рдирд╛рд╡ ( / рд╡рд╛рдкрд░реВ рд╢рдХрддрд╛ )</label>
<input id="name" placeholder="рдирд╛рд╡1 / рдирд╛рд╡2 / рдирд╛рд╡3">

<label>рдордВрдбрд│ рдХрд╛рд░реНрдпрд╛рд▓рдп</label>
<input id="office" placeholder="рдпрд╛рдВрддреНрд░рд┐рдХреА рдордВрдбрд│, рдХреЛрд▓реНрд╣рд╛рдкреВрд░">

<button onclick="save()">рдирд┐рдХрд╛рд▓ Save / Update рдХрд░рд╛</button>

<div id="success" class="success">тЬЕ рдирд┐рдХрд╛рд▓ рдпрд╢рд╕реНрд╡реАрд░реАрддреНрдпрд╛ рд╕реЗрд╡реНрд╣ рдЭрд╛рд▓рд╛</div>

<button class="logout" onclick="logout()">Logout</button>

<hr style="margin:28px 0">

<h2>ЁЯУЛ рд╕рдзреНрдпрд╛рдЪреЗ рдирд┐рдХрд╛рд▓</h2>

<table>
<thead>
<tr>
<th>рдХрд╛рд░реНрдпрдХреНрд░рдо</th>
<th>рд╕рд╣рднрд╛рдЧ</th>
<th>рдЦреЗрд│</th>
<th>рдХреНрд░рдорд╛рдВрдХ</th>
<th>рд╡рд┐рдЬреЗрддрд╛</th>
<th>Action</th>
</tr>
</thead>
<tbody id="resultBody"></tbody>
</table>

</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycby4jBFfFt6GSBlQj_Cs22HrFA-0oXMZNQd0tBHA7h_FHYR2FLqR4UFaiCAfruYJQd9-NA/exec";

/* ЁЯФР login guard */
if(sessionStorage.getItem("adminLogged")!=="1"){
  location.href="admin-login.html";
}

/* ЁЯФЧ elements */
const mainEl     = document.getElementById("main");
const typeEl     = document.getElementById("type");
const programEl  = document.getElementById("program");
const positionEl = document.getElementById("position");
const nameEl     = document.getElementById("name");
const officeEl   = document.getElementById("office");
const successEl  = document.getElementById("success");
const resultBody = document.getElementById("resultBody");

let editRow = null;

/* ЁЯФБ load programs from рдорд╛рд╣рд┐рддреА sheet */
mainEl.addEventListener("change", loadPrograms);
typeEl.addEventListener("change", loadPrograms);

async function loadPrograms(){
  programEl.innerHTML = `<option value="">тАФ рдирд┐рд╡рдбрд╛ тАФ</option>`;

  if(!mainEl.value || !typeEl.value) return;

  try{
    const res = await fetch(
      `${API}?action=adminPrograms` +
      `&main=${encodeURIComponent(mainEl.value.trim())}` +
      `&type=${encodeURIComponent(typeEl.value.trim())}` +
      `&t=${Date.now()}`
    );

    const list = await res.json();

    if(list.length === 0){
      const opt = document.createElement("option");
      opt.textContent = "тЫФ рдХрд╛рд░реНрдпрдХреНрд░рдо рдЙрдкрд▓рдмреНрдз рдирд╛рд╣реАрдд";
      opt.value = "";
      programEl.appendChild(opt);
      return;
    }

    list.forEach(p=>{
      const opt = document.createElement("option");
      opt.value = p;
      opt.textContent = p;
      programEl.appendChild(opt);
    });

  }catch(err){
    console.error("Program load error:", err);
    alert("тЭМ рдХрд╛рд░реНрдпрдХреНрд░рдо load рдХрд░рддрд╛рдирд╛ рдЕрдбрдЪрдг рдЖрд▓реА");
  }
}

/* ЁЯТ╛ save / update */
async function save(){
  successEl.style.display="none";

  if(
    !mainEl.value ||
    !typeEl.value ||
    !programEl.value ||
    !positionEl.value ||
    !nameEl.value
  ){
    alert("тЭМ рд╕рд░реНрд╡ рдорд╛рд╣рд┐рддреА рднрд░рд╛");
    return;
  }

  if(editRow){
    await fetch(`${API}?action=deleteResult&row=${editRow}`);
    editRow=null;
  }

  const params=new URLSearchParams({
    action:"saveResult",
    main:mainEl.value,
    type:typeEl.value,
    program:programEl.value,
    position:positionEl.value,
    name:nameEl.value,
    office:officeEl.value
  });

  await fetch(`${API}?${params.toString()}`);
  successEl.style.display="block";
  clearForm();
  loadResults();
}

/* ЁЯУЛ load results */
async function loadResults(){
  const res=await fetch(`${API}?action=adminResultList`);
  const list=await res.json();

  resultBody.innerHTML="";
  list.forEach(r=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${r.main}</td>
      <td>${r.type}</td>
      <td>${r.program}</td>
      <td>${r.position}</td>
      <td>${r.name}</td>
      <td>
        <button class="action-btn edit" onclick='editResult(${JSON.stringify(r)})'>тЬПя╕П</button>
        <button class="action-btn delete" onclick='deleteResult(${r.row})'>ЁЯЧСя╕П</button>
      </td>`;
    resultBody.appendChild(tr);
  });
}

/* тЬПя╕П edit */
function editResult(r){
  editRow=r.row;
  mainEl.value=r.main;
  typeEl.value=r.type;
  programEl.innerHTML=`<option value="${r.program}">${r.program}</option>`;
  positionEl.value=r.position;
  nameEl.value=r.name;
  officeEl.value=r.office;
  window.scrollTo({top:0,behavior:"smooth"});
}

/* ЁЯЧСя╕П delete */
async function deleteResult(row){
  if(!confirm("рд╣рд╛ рдирд┐рдХрд╛рд▓ delete рдХрд░рд╛рдпрдЪрд╛ рдЖрд╣реЗ рдХрд╛?")) return;
  await fetch(`${API}?action=deleteResult&row=${row}`);
  loadResults();
}

/* utils */
function clearForm(){
  mainEl.value="";
  typeEl.value="";
  programEl.innerHTML=`<option value="">тАФ рдирд┐рд╡рдбрд╛ тАФ</option>`;
  positionEl.value="";
  nameEl.value="";
  officeEl.value="";
}
function logout(){
  sessionStorage.removeItem("adminLogged");
  location.href="dashboard.html";
}

/* init */
loadResults();
</script>

</body>
</html>
