<!doctype html>
<html lang="mr">
  <head>
    <meta charset="UTF-8" />
    <title>‡§ñ‡•á‡§≥‡§æ‡§°‡•Ç ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      body {
        margin: 0;
        font-family: "Noto Sans Devanagari", "Mukta", system-ui, sans-serif;
        background: #f1f5f9;
        padding: 20px;
      }
      .container {
        max-width: 900px;
        margin: auto;
      }
      .header {
        background: #9333ea;
        color: #fff;
        padding: 20px;
        border-radius: 14px;
        text-align: center;
        margin-bottom: 20px;
      }
      .card {
        background: #fff;
        padding: 20px;
        border-radius: 14px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }
      select,
      button {
        padding: 10px;
        border-radius: 8px;
        margin: 6px 4px;
        font-size: 16px;
      }
      button {
        background: #0f766e;
        color: #fff;
        border: none;
        cursor: pointer;
      }
      table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
      }
      th {
        background: #e2e8f0;
      }
      .download {
        margin-top: 15px;
        background: #16a34a;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="header">
        <h2>‡§ñ‡•á‡§≥‡§æ‡§°‡•Ç ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</h2>
        <p>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§®‡§ø‡§µ‡§°‡§æ ‡§Ü‡§£‡§ø ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä‡§ï‡•É‡§§ ‡§ñ‡•á‡§≥‡§æ‡§°‡•Ç ‡§™‡§æ‡§π‡§æ</p>
      </div>

      <div class="card">
        <select id="office" onchange="loadPrograms()">
          <option value="">‡§Æ‡§Ç‡§°‡§≥ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø</option>
        </select>

        <select id="main" onchange="loadPrograms()">
          <option value="">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</option>
          <option value="sports">‡§ï‡•ç‡§∞‡•Ä‡§°‡§æ</option>
          <option value="cultural">‡§∏‡§æ‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø‡§ï</option>
        </select>

        <select id="type" onchange="loadPrograms()">
          <option value="">‡§∏‡§π‡§≠‡§æ‡§ó ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</option>
          <option value="individual">‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï</option>
          <option value="duheri">‡§¶‡•Å‡§π‡•á‡§∞‡•Ä</option>
          <option value="team">‡§∏‡§æ‡§Ç‡§ò‡§ø‡§ï</option>
        </select>

        <select id="program">
          <option value="">‡§ñ‡•á‡§≥ / ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</option>
        </select>

        <button onclick="loadPlayers()">‡§ñ‡•á‡§≥‡§æ‡§°‡•Ç ‡§™‡§π‡§æ</button>

        <table id="tbl" style="display: none">
          <thead>
            <tr>
              <th>‡§®‡§æ‡§µ</th>
              <th>‡§™‡§¶‡§®‡§æ‡§Æ</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <button class="download" onclick="downloadExcel()">
          Excel Download
        </button>
      </div>
    </div>

    <script>
      const API =
        "https://script.google.com/macros/s/AKfycby4jBFfFt6GSBlQj_Cs22HrFA-0oXMZNQd0tBHA7h_FHYR2FLqR4UFaiCAfruYJQd9-NA/exec";
      const officeSelect = document.getElementById("office");

      window.onload = loadOffices;

      async function loadOffices() {
        const res = await fetch(`${API}?action=offices`);
        const list = await res.json();

        list.forEach((o) => {
          const opt = document.createElement("option");
          opt.value = o;
          opt.textContent = o;
          officeSelect.appendChild(opt);
        });
      }
      const mainSelect = document.getElementById("main");
      const typeSelect = document.getElementById("type");
      const programSelect = document.getElementById("program");

      let playerData = [];

      async function loadPrograms() {
        const main = mainSelect.value;
        const type = typeSelect.value;
        const office = document.getElementById("office").value;

        if (!main || !type || !office) return;

        const mainMr = main === "sports" ? "‡§ï‡•ç‡§∞‡•Ä‡§°‡§æ" : "‡§∏‡§æ‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø‡§ï";

        const typeMr =
          type === "individual"
            ? "‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï"
            : type === "duheri"
              ? "‡§¶‡•Å‡§π‡•á‡§∞‡•Ä"
              : "‡§∏‡§æ‡§Ç‡§ò‡§ø‡§ï";

        const res = await fetch(
          `${API}?action=programs` +
            `&main=${encodeURIComponent(mainMr)}` +
            `&type=${encodeURIComponent(typeMr)}`,
        );

        const list = await res.json();

        programSelect.innerHTML = '<option value="">‡§ñ‡•á‡§≥ / ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</option>';

        list.forEach((p) => {
          const o = document.createElement("option");
          o.value = p;
          o.textContent = p;
          programSelect.appendChild(o);
        });
      }

      async function loadPlayers() {
        const office = officeSelect.value;
        const main = mainSelect.value;
        const type = typeSelect.value;
        const prog = programSelect.value;

        if (!office || !main || !type || !prog) return;

        const mainMr = main === "sports" ? "‡§ï‡•ç‡§∞‡•Ä‡§°‡§æ" : "‡§∏‡§æ‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø‡§ï";

        const typeMr =
          type === "individual"
            ? "‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï"
            : type === "duheri"
              ? "‡§¶‡•Å‡§π‡•á‡§∞‡•Ä"
              : "‡§∏‡§æ‡§Ç‡§ò‡§ø‡§ï";

        const res = await fetch(
          `${API}?action=playersList` +
            `&office=${encodeURIComponent(office)}` +
            `&main=${encodeURIComponent(mainMr)}` +
            `&type=${encodeURIComponent(typeMr)}` +
            `&program=${encodeURIComponent(prog)}`,
        );

        playerData = await res.json();

        const tbody = document.querySelector("#tbl tbody");
        tbody.innerHTML = "";

        playerData.forEach((p) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${p.name}</td><td>${p.designation}</td>`;
          tbody.appendChild(tr);
        });

        document.getElementById("tbl").style.display = "table";
      }

      function downloadExcel(){
  if(playerData.length===0) return;

  const officeText = officeSelect.options[officeSelect.selectedIndex].text;

  const mainText =
    mainSelect.value === "sports" ? "‡§ï‡•ç‡§∞‡•Ä‡§°‡§æ" : "‡§∏‡§æ‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø‡§ï";

  const typeText =
    typeSelect.value === "individual" ? "‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï" :
    typeSelect.value === "duheri" ? "‡§¶‡•Å‡§π‡•á‡§∞‡•Ä" : "‡§∏‡§æ‡§Ç‡§ò‡§ø‡§ï";

  const programText = programSelect.value;

  let csv = "";

  // üîπ Header Info
  csv += `‡§Æ‡§Ç‡§°‡§≥ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø:,${officeText}\n`;
  csv += `‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞:,${mainText}\n`;
  csv += `‡§∏‡§π‡§≠‡§æ‡§ó ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞:,${typeText}\n`;
  csv += `‡§ñ‡•á‡§≥ / ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ:,${programText}\n\n`;

  // üîπ Table Header
  csv += "‡§®‡§æ‡§µ,‡§™‡§¶‡§®‡§æ‡§Æ\n";

  // üîπ Players
  playerData.forEach(p=>{
    csv += `"${p.name}","${p.designation}"\n`;
  });

  const blob = new Blob([csv], { type: "text/csv" });
  const url = window.URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "players_list.csv";
  a.click();
}

    </script>
  </body>
</html>
