<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<title>‡§∏‡§Æ‡§®‡•ç‡§µ‡§Ø‡§ï ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:"Mukta",sans-serif;
  background:#f1f5f9;
  padding:20px;
}

.card{
  max-width:720px;
  margin:auto;
  background:#fff;
  padding:24px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
}

h2{text-align:center;margin-bottom:18px;}

input, select{
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px;
}

button{
  margin-top:14px;
  padding:12px;
  width:100%;
  border:none;
  border-radius:8px;
  background:#16a34a;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}

table{
  width:100%;
  margin-top:22px;
  border-collapse:collapse;
  font-size:14px;
}

th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
}

th{
  background:#1e40af;
  color:#fff;
}
</style>
</head>

<body>

<div class="card">
  <h2>‡§∏‡§Æ‡§®‡•ç‡§µ‡§Ø‡§ï ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§±‡•ç‡§Ø‡§æ‡§Ç‡§ö‡•Ä ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§≠‡§∞‡§æ</h2>

  <!-- ‚úÖ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø -->
  <select id="office">
    <option value="">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ</option>
  </select>

  <select id="type">
    <option value="">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§®‡§ø‡§µ‡§°‡§æ</option>
    <option>‡§ï‡•ç‡§∞‡•Ä‡§°‡§æ ‡§∏‡•ç‡§™‡§∞‡•ç‡§ß‡§æ</option>
    <option>‡§∏‡§æ‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø‡§ï ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</option>
  </select>

  <input type="text" id="event" placeholder="‡§ñ‡•á‡§≥ / ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ‡§æ‡§ö‡•á ‡§®‡§æ‡§µ">
  <input type="text" id="name" placeholder="‡§∏‡§Æ‡§®‡•ç‡§µ‡§Ø‡§ï ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§±‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ">
  <input type="text" id="post" placeholder="‡§™‡§¶‡§®‡§æ‡§Æ">
  <input type="tel" id="mobile" maxlength="10" pattern="[0-9]{10}" placeholder="‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï">

  <button onclick="addEntry()">‡§®‡•ã‡§Ç‡§¶ ‡§ú‡•ã‡§°‡§æ</button>

  <table id="dataTable">
    <thead>
      <tr>
        <th>‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</th>
        <th>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</th>
        <th>‡§®‡§æ‡§µ</th>
        <th>‡§™‡§¶‡§®‡§æ‡§Æ</th>
        <th>‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){

// üîê login check
if(sessionStorage.getItem("coordAuth") !== "1"){
  location.href="coordinator-login.html";
}

const API_URL = "https://script.google.com/macros/s/AKfycby4jBFfFt6GSBlQj_Cs22HrFA-0oXMZNQd0tBHA7h_FHYR2FLqR4UFaiCAfruYJQd9-NA/exec";

const officeEl = document.getElementById("office");
const typeEl   = document.getElementById("type");
const eventEl  = document.getElementById("event");
const nameEl   = document.getElementById("name");
const postEl   = document.getElementById("post");
const mobileEl = document.getElementById("mobile");

// ‚úÖ offices load
fetch(API_URL + "?action=offices")
.then(r=>r.json())
.then(offices=>{
  offices.forEach(o=>{
    const op = document.createElement("option");
    op.value = o;
    op.textContent = o;
    officeEl.appendChild(op);
  });
});

// table render helper
function addRow(d){
  const tbody = document.querySelector("#dataTable tbody");
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${d.type}</td>
    <td>${d.event}</td>
    <td>${d.name}</td>
    <td>${d.post}</td>
    <td>${d.mobile}</td>
  `;
  tbody.prepend(tr);
}

// ‚úÖ button function global ‡§ï‡§∞
window.addEntry = async function(){

  const entry = {
    action: "addCoordinator",
    office: officeEl.value.trim(),
    type: typeEl.value.trim(),
    event: eventEl.value.trim(),
    name: nameEl.value.trim(),
    post: postEl.value.trim(),
    mobile: mobileEl.value.trim()
  };

  if(!entry.office || !entry.type || !entry.event || !entry.name){
    alert("‡§∏‡§∞‡•ç‡§µ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§≠‡§∞‡§æ");
    return;
  }

  try{
    const res = await fetch(API_URL,{
      method:"POST",
      body: JSON.stringify(entry)
    });

    const d = await res.json();

    if(d.ok){
      alert("‡§®‡•ã‡§Ç‡§¶ ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä ‡§ù‡§æ‡§≤‡•Ä ‚úÖ");
      addRow(entry);

      officeEl.value="";
      typeEl.value="";
      eventEl.value="";
      nameEl.value="";
      postEl.value="";
      mobileEl.value="";
    }else{
      alert(d.message || "Server error");
    }

  }catch(e){
    alert("Connection error");
  }

};

});
</script>

</body>
</html>
