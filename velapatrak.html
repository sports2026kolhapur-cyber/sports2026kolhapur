<!doctype html>
<html lang="mr">
  <head>
    <meta charset="UTF-8" />
    <title>‡§µ‡•á‡§≥‡§æ‡§™‡§§‡•ç‡§∞‡§ï ‚Äì ‡§∏‡•ç‡§™‡§∞‡•ç‡§ß‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      body {
        margin: 0;
        font-family: "Noto Sans Devanagari", "Mukta", system-ui, sans-serif;
        background: #f1f5f9;
        padding: 20px;
        padding-bottom: 90px;
        color: #1f2937;
      }

      .back-btn {
        position: fixed;
        bottom: 16px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 999;
        background: #1e40af;
        color: #ffffff;
        padding: 12px 22px;
        border-radius: 14px;
        font-weight: 700;
        text-decoration: none;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      }

      .container {
        max-width: 800px;
        margin: 100px auto;
        background: #ffffff;
        padding: 40px 24px;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        text-align: center;
      }

      select,
      input {
        width: 100%;
        padding: 12px;
        margin-top: 14px;
        border-radius: 10px;
        border: 1.6px solid #cbd5e1;
        font-size: 15px;
      }
      button:disabled {
        background: #94a3b8;
        cursor: not-allowed;
      }
      button {
        margin-top: 16px;
        padding: 12px;
        border: none;
        border-radius: 10px;
        background: #16a34a;
        color: #fff;
        font-weight: 700;
        cursor: pointer;
      }

      .result-card {
        background: #eef2ff;
        margin-top: 16px;
        padding: 16px;
        border-radius: 12px;
        text-align: left;
      }
    </style>
  </head>

  <body>
    <a href="dashboard.html" class="back-btn">‚¨ÖÔ∏è ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°‡§µ‡§∞ ‡§™‡§∞‡§§ ‡§ú‡§æ</a>

    <div class="container">
      <h2>üìÖ ‡§µ‡•á‡§≥‡§æ‡§™‡§§‡•ç‡§∞‡§ï ‡§™‡§π‡§æ</h2>

      <select id="main">
        <option value="">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§®‡§ø‡§µ‡§°‡§æ</option>
        <option value="sports">‡§ï‡•ç‡§∞‡•Ä‡§°‡§æ</option>
        <option value="cultural">‡§∏‡§æ‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø‡§ï</option>
      </select>

      <select id="type">
        <option value="">‡§∏‡§π‡§≠‡§æ‡§ó ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§®‡§ø‡§µ‡§°‡§æ</option>
        <option value="individual">‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï</option>
        <option value="duheri">‡§¶‡•Å‡§π‡•á‡§∞‡•Ä</option>
        <option value="team">‡§∏‡§æ‡§Ç‡§ò‡§ø‡§ï</option>
      </select>

      <select id="program" disabled>
        <option value="">‡§ñ‡•á‡§≥ / ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§®‡§ø‡§µ‡§°‡§æ</option>
      </select>

      <button id="showBtn" onclick="loadVelapatrak()" disabled>
        ‡§µ‡•á‡§≥‡§æ‡§™‡§§‡•ç‡§∞‡§ï ‡§™‡§π‡§æ
      </button>

      <div id="result"></div>
    </div>

    <script>
      const API =
        "https://script.google.com/macros/s/AKfycby4jBFfFt6GSBlQj_Cs22HrFA-0oXMZNQd0tBHA7h_FHYR2FLqR4UFaiCAfruYJQd9-NA/exec";

      // ‚úÖ DOM ready ‡§ù‡§æ‡§≤‡•ç‡§Ø‡§æ‡§µ‡§∞‡§ö events ‡§≤‡§æ‡§µ‡§æ
      window.addEventListener("DOMContentLoaded", () => {
        document
          .getElementById("main")
          .addEventListener("change", loadPrograms);
        document
          .getElementById("type")
          .addEventListener("change", loadPrograms);

        const clearResult = () => {
          document.getElementById("result").innerHTML = "";
        };

        document.getElementById("main").addEventListener("change", clearResult);
        document.getElementById("type").addEventListener("change", clearResult);
        document
          .getElementById("program")
          .addEventListener("change", clearResult);
        const toggleBtn = () => {
          const main = document.getElementById("main").value;
          const type = document.getElementById("type").value;
          const program = document.getElementById("program").value;
          document.getElementById("showBtn").disabled = !(
            main &&
            type &&
            program
          );
        };

        document.getElementById("main").addEventListener("change", toggleBtn);
        document.getElementById("type").addEventListener("change", toggleBtn);
        document
          .getElementById("program")
          .addEventListener("change", toggleBtn);
        toggleBtn(); // ‚úÖ initial state fix
      });

      function formatDate(d) {
        const dt = new Date(d);
        return dt.toLocaleDateString("mr-IN", {
          day: "2-digit",
          month: "long",
          year: "numeric",
        });
      }

      // ‚úÖ Load programs dynamically
      async function loadPrograms() {
        const main = document.getElementById("main").value;
        const type = document.getElementById("type").value;

        const prog = document.getElementById("program");
        prog.innerHTML = '<option value="">‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...</option>';
        prog.disabled = true;

        if (!main || !type) {
          prog.innerHTML = '<option value="">‡§ñ‡•á‡§≥ / ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§®‡§ø‡§µ‡§°‡§æ</option>';
          prog.disabled = true;
          return;
        }

        try {
          const res = await fetch(
            `${API}?action=velapatrakPrograms&main=${main}&type=${type}`,
          );

          const list = await res.json();

          prog.innerHTML = '<option value="">‡§ñ‡•á‡§≥ / ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§®‡§ø‡§µ‡§°‡§æ</option>';

          if (list.length === 0) {
            prog.innerHTML =
              '<option value="">‡§Ø‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞‡§æ‡§∏‡§æ‡§†‡•Ä ‡§µ‡•á‡§≥‡§æ‡§™‡§§‡•ç‡§∞‡§ï ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä</option>';
            prog.disabled = true;
            document.getElementById("showBtn").disabled = true;
            return;
          }

          list.forEach((p) => {
            const opt = document.createElement("option");
            opt.value = p;
            opt.textContent = p;
            prog.appendChild(opt);
          });

          prog.disabled = false;
          document.getElementById("showBtn").disabled = true;
        } catch (err) {
          prog.innerHTML = '<option value="">Server error</option>';
          prog.disabled = true;
          document.getElementById("showBtn").disabled = true;
        }
      }
      // ‚úÖ Load velapatrak
      async function loadVelapatrak() {
        const main = document.getElementById("main").value;
        const type = document.getElementById("type").value;
        const program = document.getElementById("program").value.trim();
        document.getElementById("result").innerHTML = "";
        if (!main || !type || !program) {
          alert("‡§∏‡§∞‡•ç‡§µ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§≠‡§∞‡§æ");
          return;
        }

        const box = document.getElementById("result");
        box.innerHTML = "‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...";

        try {
          const res = await fetch(
            `${API}?action=velapatrakFilter&main=${main}&type=${type}&program=${encodeURIComponent(program)}`,
          );

          //https://script.google.com/macros/s/AKfycby4jBFfFt6GSBlQj_Cs22HrFA-0oXMZNQd0tBHA7h_FHYR2FLqR4UFaiCAfruYJQd9-NA/exec?action=velapatrakFilter&main=‡§ï‡•ç‡§∞‡•Ä‡§°‡§æ&type=‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï&program=‡§ú‡§≤‡§§‡§∞‡§£ ‡•´‡•¶ ‡§Æ‡•Ä ‡§´‡•ç‡§∞‡•Ä ‡§∏‡•ç‡§ü‡§æ‡§à‡§≤

          const data = await res.json();

          if (data.length === 0) {
            box.innerHTML = "<p>‡§µ‡•á‡§≥‡§æ‡§™‡§§‡•ç‡§∞‡§ï ‡§∏‡§æ‡§™‡§°‡§≤‡•á ‡§®‡§æ‡§π‡•Ä</p>";
            return;
          }

          box.innerHTML = "";

          data.forEach((d) => {
            box.innerHTML += `
      <div class="result-card">
        <b>${d.round}</b><br>
        üÜö ${d.teamA} vs ${d.teamB}<br>
        üìÖ ${formatDate(d.date)} ‚è∞ ${d.time}<br>
        üìç ${d.venue}
      </div>
    `;
          });
        } catch (e) {
          box.innerHTML = "Server error. ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ.";
        }
      }
    </script>
  </body>
</html>
